---
title: "Sex biased mutation rate"
author: "Isobel Beasley & 	Yasmine McDonough"
output: workflowr::wflow_html
editor_options:
  chunk_output_type: console
---

## Set up

```{r setup}

library(ggplot2)
suppressMessages(library(dplyr))
library(reactable)

# only look at public sheets - so no authentication is needed
googlesheets4::gs4_deauth()

# read in sex bias mutation data.frame
sex_bias_mut_df = googlesheets4::read_sheet("https://docs.google.com/spreadsheets/d/10ZVgeGlDpEnPG-4zLLrSBQjF7p2_9hzzIMPuIRuvogg/edit#gid=537547888", range = "Alpha Estimates (each row is a single estimate)")

head(sex_bias_mut_df) %>% reactable()

# Set up custom theme for ggplots
custom_theme <-
  list(
    theme_bw() +
      theme(
        panel.border = element_blank(),
        axis.line = element_line(),
        text = element_text(size = 25),
        legend.position = "bottom",
        strip.background = element_blank(),
        axis.text.x = element_text(angle = 90, hjust = 1, vjust = 0.5)
      )
  )

```

## Number of estimates per taxonomic class

```{r n_by_taxo_class}

sex_bias_mut_df %>% 
  group_by(taxonomic_class) %>% 
  summarise(n = n()) %>% 
  reactable()

```

## Number of estimates per method used to calculate the sex-biased mutation rate

```{r n_by_method}

sex_bias_mut_df %>% 
  group_by(method_used_to_calculate_alpha) %>% 
  summarise(n = n()) %>% 
  reactable(defaultPageSize = 50)

```

## Number of estimates by both taxonomic class and method used to calculate

```{r n_by_method_and_taxo_class}

sex_bias_mut_df %>% 
  group_by(taxonomic_class,method_used_to_calculate_alpha) %>% 
  summarise(n = n()) %>% 
  reactable(defaultPageSize = 50)

```

# Distribution of sex-biased mutation estimates

## Across all taxonomic classes

```{r dist_sex_est, fig.height = 8, fig.width = 12}

sex_bias_mut_df %>% 
  ggplot(aes(x=alpha_point_estimate)) + 
  geom_histogram(bins = 50) + 
  labs(title = "Distribution of estimated sex-biased mutation rate",
        x = "Point estimate of the male-biased mutation rate (alpha)",
       y= "Count") + 
  custom_theme + 
  geom_vline(xintercept = 1, col = "red", linetype = 2) + 
  annotate(
  "text",
  x = 3,
  y = 35,
  size = 9,
  hjust = 0,
  col = "red", 
  label = "Line of equal mutation rate across the sexes"
)

summary(sex_bias_mut_df$alpha_point_estimate)

sex_bias_mut_df %>% 
  ggplot(aes(x=alpha_point_estimate)) +
  geom_boxplot() + 
  custom_theme+ 
   labs(title = "Distribution of estimated sex-biased mutation rate",
        x = "Point estimate of the male-biased mutation rate (alpha)") 

```

## By Taxonomic Class

```{r sex_bias_by_taxo_class, fig.height = 8, fig.width = 12}

sex_bias_mut_df %>% 
  ggplot(aes(x=alpha_point_estimate)) + 
  geom_histogram(bins = 25) + 
  labs(title = "Distribution of estimated sex-biased mutation rate",
        x = "Point estimate of the male-biased mutation rate (alpha)",
       y= "Count") + 
  custom_theme + 
  geom_vline(xintercept = 1, col = "red", linetype = 2) + 
  facet_wrap(~taxonomic_class)

```

## By method used to calculate estimate of male-biased mutation rate

```{r sex_bias_by_method, fig.height=10, fig.width = 15}
sex_bias_mut_df %>% 
  ggplot(aes(x=alpha_point_estimate)) + 
  geom_histogram() + 
  custom_theme + 
  facet_wrap(~method_used_to_calculate_alpha) + 
  theme(text = element_text(size = 8))
```
